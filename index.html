<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Type@ Example</title>
		<link type="text/css" href="css/ui-lightness/jquery-ui-1.8.18.custom.css" rel="stylesheet" />	
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
		<script>
		var recordedString = '';  //once '@' is typed, record it here.
				var startRecording = false;  //trigger
			function getCaret(el) { 
				if (el.selectionStart) { 
					return el.selectionStart; 
				} else if (document.selection) { 
					el.focus(); 

					var r = document.selection.createRange(); 
					if (r == null) { 
					  return 0; 
					} 
					var re = el.createTextRange(), 
						rc = re.duplicate(); 
					re.moveToBookmark(r.getBookmark()); 
					rc.setEndPoint('EndToStart', re); 

					return rc.text.length; 
				}
				return 0; 
			}
			$(document).ready(function() {
				
				$( "#inputName" ).bind('keypress', function(event) {
					if ( event.which === 64 && event.shiftKey === true) {
						//'@'
						startRecording = true;
						recordedString = '';  //start anew
					}
					if (startRecording === true) {
						//Allow only 0-9, a-z, A-Z, -, _
						if (event.which >= 48 && event.which <=57 
							|| event.which >= 65 && event.which <=90
							|| event.which >= 96 && event.which <=105
							|| event.which === 189) {
							recordedString += String.fromCharCode(event.which);
						}
						
						//query once recording has started.
						$.ajax({
							url: 'request.php',
							data: 'term=' + recordedString,
							success: function(data) {
								console.log('response: ', data);
								$('#testResult').html(data);
							}
						});
					}
					console.log( recordedString , event);
				});
				$( "#inputName" ).bind('blur', function(event) {
					//escape
					startRecording = false;
					recordedString = '';  //clean
				});
				$( "#inputName" ).bind('keydown', function(event) {
					if ( event.keyCode === 8 ) {
						//backspace   //-1
						recordedString = recordedString.substring(0, recordedString.length - 1);
					}
					else if ( event.keyCode === 27 || event.keyCode === 32) {
						//escape and space
						startRecording = false;
						recordedString = '';  //clean
					}
					else if ( event.keyCode === 46) {
						//delete
					}
				});
			});
		</script>

		<div class="demo">

		<div class="ui-widget">
			<label for="inputName">Input: </label>
			<div style="width: 500px;">
				<textarea id="inputName" style="width:100%; margin: 0px; padding: 0px"></textarea>
			</div>
			<div id="testResult">
			</div>
		</div>

		</div><!-- End demo -->
		<div class="demo-description">
		<p>Try @h1, @h2, @h3.</p>
		</div><!-- End demo-description -->
	</body>
</html>


